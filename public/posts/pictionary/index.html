<!DOCTYPE html>
<html>
  <head>
    <title>A live pictionary using websockets</title>
    








  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="A live pictionary using websockets" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    











  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_3.png">Ahmad Hamze Homepage</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_3.png" class="d-none" id="main-logo">
  <img src="/images/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/estimating-pi/">Monte-Carlo Estimation of Pi</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/earthquakes/">Mapping Earthquakes Locations on a Map</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/pictionary/">Pictionary using websockets</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/c&#43;&#43;-matrix/">Simple C&#43;&#43; matrix calculation</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/algorithmics/">Algorithmics Blogs</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/algorithmics/memoization/">Recursion with Memoization</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/automation/">Automation Programs</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/automation/puppeteer-vs-selenium/">Puppeteer vs Selenium</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/automation/selenium-speed-test/">Selenium Speed Test</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/opinion/">Opinion Blogs</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/opinion/advice-to-myself/">Advice to my past self</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/opinion/first-react-job/">Web Dev Learned Lessons</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/react/">React Applications</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/react/trivia-quiz/">React Trivia Quiz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/react/storybook-trivia-quiz/">Storybook with React</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(http://AhmadHamze.github.io/posts/pictionary/hero.png);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/my-photo.jpg'/>
          <h5 class="author-name">Ahmad Hamze</h5>
          <p>September 18, 2021</p>
        </div>

        <div class="title">
          <h1>A live pictionary using websockets</h1>
        </div>

        <div class="post-content" id="post-content">
          <h2 id="introduction">Introduction</h2>
<p>This is a project that uses websockets to create a drawing on a page and copy this drawing to another page instantly.</p>
<p>If you&rsquo;ve never heard of websockets before, here&rsquo;s the main idea:</p>
<ol>
<li>
<p>You send data from your browser to a server using a &ldquo;socket&rdquo; which is a real-time connection that can send data back and forth.</p>
</li>
<li>
<p>There is another computer that is connected to the server and will receive the data from it also using a socket.</p>
</li>
</ol>
<p>In this project we will be using the same computer, however, we will open multiple tabs in the browser all on the same localhost where the server will be listening.</p>
<h2 id="stack">Stack</h2>
<p>To create the drawing I used the <a href="https://p5js.org/">p5.js</a> library, express for the server, and the <a href="https://socket.io/">socket.io</a> library which handles the websockets. Node will host the p5 sketch as a static file (this topic won&rsquo;t be covered here).</p>
<p>You can find this project on <a href="https://github.com/AhmadHamze/pictionary">GitHub</a>, here you can find the complete code.<br>
I recommend that you take a look if you&rsquo;re not familiar with node and express, I won&rsquo;t be covering these topics.
You can also find instructions on how to run the project locally on your computer.</p>
<h2 id="initialization">Initialization</h2>
<p>The first thing we need to do is to enable the use of websockets on the front-end. The easiest way to enable the websockets is to use the following cdn:</p>
<p><code>&lt;script src=&quot;https://cdn.socket.io/4.1.2/socket.io.min.js&quot; integrity=&quot;sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</code></p>
<p>It&rsquo;s added within the head tag of the main html file (the file hosting the p5 sketch).</p>
<p>The next step is to create a websocket and to connect it to the port where the backend will be listening (this will be done shortly).</p>
<p>This is the code doing so, it&rsquo;s found in <em>sketch.js</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">socket</span>;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setup</span>() {
  <span style="color:#75715e">/* sketch code */</span>
  <span style="color:#a6e22e">socket</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#34;http://localhost:5000&#34;</span>);
}
</code></pre></div><blockquote>
<p><em>The setup function is specific to the p5 library check the <a href="https://p5js.org/reference/#/p5/setup">documentation</a> for more information</em></p>
</blockquote>
<h2 id="drawing-and-sending-the-sketch-to-the-back-end">Drawing and sending the sketch to the back-end</h2>
<p>Now, we want a function to draw a sketch using the mouse and we want to send this drawing to the back-end in order to send it back to the front-end again.</p>
<p>Fundamentally a drawing is a bunch of disks each having an x,y coordinate on the sketch. These coordinates are the data that should be sent using the sockets.</p>
<p>The following function &ldquo;pen&rdquo; takes care of this, it allows drawing using the mouse and sends the data (the (x,y) coordinates) to the back-end.</p>
<blockquote>
<p>Notice this line <code>socket.emit(&quot;coordinates&quot;, data);</code> the data are sent under the name of &ldquo;coordinates&rdquo; this will be useful when receiving the data in the back-end.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pen</span>() {
        <span style="color:#a6e22e">noStroke</span>();
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">mouseIsPressed</span>) {
            <span style="color:#a6e22e">fill</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>);
            <span style="color:#a6e22e">ellipse</span>(<span style="color:#a6e22e">mouseX</span>, <span style="color:#a6e22e">mouseY</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>);

            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> {
            <span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mouseX</span>,
            <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mouseY</span>,
            };
            <span style="color:#75715e">// Sending the data under the name &#34;coordinates&#34;
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#34;coordinates&#34;</span>, <span style="color:#a6e22e">data</span>);
        }
    }
</code></pre></div><h2 id="receiving-the-data-in-the-back-end-and-sending-it-back-to-the-front-end">Receiving the data in the back-end and sending it back to the front-end</h2>
<p>We need to establish a connection and &ldquo;grab&rdquo; the data coming from the front-end.<br>
Remember that the data are emitted by the socket under the name &ldquo;coordinates&rdquo;, so to grab them we will use
<code>socket.on(&quot;coordinates&quot;, (data) =&gt; {...})</code></p>
<p>within the call-back we will send back the data to the front-end again but not to the same client that sent it originally, we don&rsquo;t want to redraw the same sketch onto the same client.<br>
We will use the &ldquo;broadcast&rdquo; flag, it sets a modifier for the emission which makes sure the data will only be broadcasted to every socket but the sender.</p>
<p>Here is the complete code for receiving and sending back data.</p>
<blockquote>
<p>Notice that we are sending back the data under the same name &ldquo;coordinates&rdquo;.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">io</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">socket</span>(<span style="color:#a6e22e">server</span>);

<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">sockets</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;connection&#34;</span>, (<span style="color:#a6e22e">socket</span>) =&gt; {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`new connection: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
  <span style="color:#75715e">// Receiving the data from the front-end
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;coordinates&#34;</span>, (<span style="color:#a6e22e">data</span>) =&gt; {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>);
    <span style="color:#75715e">// Sending back the coordinates to the client, notice this way the
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// client sending the coordinates will not receive back what it already sent.
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">broadcast</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#34;coordinates&#34;</span>, <span style="color:#a6e22e">data</span>);
  });
});
</code></pre></div><h2 id="receiving-the-data-from-the-back-end-and-drawing-a-new-sketch">Receiving the data from the back-end and drawing a new sketch</h2>
<p>This is the final stage, we will create a new function that draws a new sketch using the data received from the backend (the (x,y) coordinates).</p>
<p>To do so we will listen to the incoming event emitted from the back-end, we will add the listener to the &ldquo;setup&rdquo; function, here is the final version:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setup</span>() {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createCanvas</span>(<span style="color:#ae81ff">500</span>, <span style="color:#ae81ff">500</span>);
        <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">parent</span>(<span style="color:#e6db74">&#34;container&#34;</span>);
        <span style="color:#a6e22e">background</span>(<span style="color:#ae81ff">0</span>);
        <span style="color:#a6e22e">socket</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#34;http://localhost:5000&#34;</span>);
        <span style="color:#75715e">// the socket receiving data from the back-end
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">socket</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;coordinates&#34;</span>, <span style="color:#a6e22e">newDrawing</span>);
    }
</code></pre></div><p>The &ldquo;newDrawing&rdquo; argument is a function that we will define, it draws the new sketch with a different color.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">newDrawing</span>(<span style="color:#a6e22e">data</span>) {
        <span style="color:#a6e22e">noStroke</span>();
        <span style="color:#a6e22e">fill</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>);
        <span style="color:#a6e22e">ellipse</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">y</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>);
    }
</code></pre></div><h2 id="result">Result</h2>
<p>That&rsquo;s it all is done, run the server and open two or more tabs on <code>http://localhost:5000</code>, draw anything on a canvas (it will be blue), you will see the same drawing on the other canvases with a different color (green).</p>
<p>The initial drawing</p>
<p><img src="./images/draw.png" alt="hand draw"></p>
<p>The drawing made by the websocket</p>
<p><img src="./images/automatic-draw.png" alt="automatic draw"></p>

        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/AhmadHamze/AhmadHamze.github.io.git/edit//content/posts/pictionary/index.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/earthquakes/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Mapping Earthquakes Locations on a Map</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/c&#43;&#43;-matrix/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>My first C&#43;&#43; console application</span>
          </a>
        </div>
      
    
  

  

  

  

  

  

  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#About">About me</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#Skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Blogs</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>ahmadhamze@yahoo.com</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">Â© 2021 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
